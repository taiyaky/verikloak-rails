# frozen_string_literal: true

Rails.application.configure do
  config.verikloak.discovery_url = ENV.fetch('KEYCLOAK_DISCOVERY_URL', nil)
  config.verikloak.audience      = ENV.fetch('VERIKLOAK_AUDIENCE', 'rails-api')
  config.verikloak.issuer        = ENV.fetch('VERIKLOAK_ISSUER', nil)
  config.verikloak.leeway        = Integer(ENV.fetch('VERIKLOAK_LEEWAY', '60'))
  config.verikloak.skip_paths    = %w[/up /health /rails/health]
  config.verikloak.trust_forwarded_access_token = ENV.fetch('VERIKLOAK_TRUST_FWD_TOKEN', 'false') == 'true'
  # IMPORTANT: When enabling the above, set trusted_proxy_subnets; leaving it empty trusts all peers.
  # config.verikloak.trusted_proxy_subnets = ["10.0.0.0/8", "192.168.0.0/16"]

  config.verikloak.logger_tags = %i[request_id sub]
  config.verikloak.auto_include_controller = true
  config.verikloak.render_500_json = ENV.fetch('VERIKLOAK_RENDER_500', 'false') == 'true'
  config.verikloak.token_header_priority = %w[HTTP_X_FORWARDED_ACCESS_TOKEN HTTP_AUTHORIZATION]
  config.verikloak.rescue_pundit = ENV.fetch('VERIKLOAK_RESCUE_PUNDIT', 'true') == 'true'
end
